# FCM & APNs

## 소개

- FCM의 주요 기능
  1. 알림 메시지 또는 데이터 메시지를 보낼 수 있다
     - 알림 메시지 : FCM SDK가 클라이언트 앱을 대신하여 앱푸시를 표시해준다
     - 데이터 메시지 : 커스텀 키-값 쌍만 있고, 그 값으로 클라이언트 앱이 처리한다
  2. 수신자를 3가지 방식으로 지정할 수 있다 (단일 기기에만, 기기 그룹에게, 토픽을 구독한 기기에게 모두)
  3. 클라이언트 앱에서 메시지를 전송할 수 있다
- FCM 구현에는 다음 2가지가 필요하다
  1. 메시지를 작성, 타겟팅, 전송할 수 있는 신뢰할 수 있는 환경(Firebase용 Cloud Functions 또는 앱서버 등..)
  2. 클라이언트 앱(Apple, Android, 웹 등..)
- 메시지를 보내는 방식 (택1)
  1. Firebase Admin SDK
  2. FCM 서버 프로토콜
- 구현 순서
  1. FCM SDK 설정 (앱에서 Firebase 및 FCM을 설정한다)
  2. 클라이언트 앱 개발 (메시지 처리, 토픽 구독 로직 등을 구현한다. 개발 중에는 알림 작성기에서 테스트 메시지를 보낼 수 있음)
  3. 앱 서버 개발
     - 인증, 앱푸시 요청, 응답 처리등을 구현할 때 사용할 방식 결정해야 한다 (Firebase Admin SDK or FCM 서버 프로토콜)
     - 신뢰할 수 있는 환경에서 로직을 구축한다
     - 참고 : 클라이언트 애플리케이션에서 업스트림 메시징을 사용하려면 XMPP를 사용해야 함. 또한 Cloud Functions는 XMPP에 필요한 영구적 연결을 지원하지 않음

## FCM 아키텍쳐 개요

![이 페이지에 설명된 세 가지 아키텍처 레이어의 다이어그램](https://firebase.google.com/docs/cloud-messaging/images/diagram-FCM.png?hl=ko)

